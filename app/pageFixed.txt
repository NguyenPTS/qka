interface SaleQuestion {
  id: string;
  _id?: string;  // Thêm _id optional cho câu hỏi đã lưu vào MongoDB
  text: string;
  keyword?: string;
  images: Array<{ id: string; url: string; }>;
  status: 'pending' | 'done';
  createdAt: Date;
  answer?: string;
}

const handleSaleAnswerChange = (questionId: string, value: string) => {
  setSaleAnswers((prev) => ({ ...prev, [questionId]: value }));
};

const handleSaleAnswerKeywordChange = (questionId: string, value: string) => {
  setSaleAnswerKeywords((prev) => ({ ...prev, [questionId]: value }));
};

const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>, questionId: string) => {
  const files = Array.from(e.target.files || []);
  setQuestionImages(prev => ({
    ...prev,
    [questionId]: [...(prev[questionId] || []), ...files]
  }));
};

const removeImage = (questionId: string, index: number) => {
  setQuestionImages(prev => ({
    ...prev,
    [questionId]: prev[questionId].filter((_, i) => i !== index)
  }));
};

const deleteSaleQuestion = (questionId: string) => {
  setSaleQuestions((prev) => prev.filter((q) => q.id !== questionId));
};

const resetSaleToPending = (questionId: string) => {
  setSaleQuestions((prev) => 
    prev.map((q) => (q.id === questionId ? { ...q, status: "pending", answer: undefined } : q))
  );
};

const saleFilteredQuestions = saleQuestions.filter((q) => q.status === saleCurrentTab);

const getKeywordsArray = (keyword: string | string[]): string[] => {
  return Array.isArray(keyword) ? keyword : [keyword];
};

const getImageUrl = (url: string | undefined): string | null => {
  if (!url) {
    console.log('URL is empty');
    return null;
  }
  
  console.log('Original image URL:', url);
  try {
    if (url.startsWith('blob:')) {
      console.log('URL is blob:', url);
      return null;
    }

    if (url.match(/^https?:\/\//)) {
      console.log('Using original URL:', url);
      return url;
    }

    if (url.startsWith('/wp-content')) {
      const fullUrl = `https://wordpress.pharmatech.vn${url}`;
      console.log('Converted to full URL:', fullUrl);
      return fullUrl;
    }

    const baseUrl = 'https://wordpress.pharmatech.vn';
    const fullUrl = `${baseUrl}${url.startsWith('/') ? '' : '/'}${url}`;
    console.log('Converted to full URL:', fullUrl);
    return fullUrl;
  } catch (error) {
    console.error('Error processing image URL:', error);
    return null;
  }
};

const sortQuestions = (a: Question, b: Question, sortBy: string, sortOrder: 'asc' | 'desc') => {
  if (sortBy === 'createdAt') {
    const aTime = a._id ? new Date(a._id).getTime() : 0;
    const bTime = b._id ? new Date(b._id).getTime() : 0;
    return sortOrder === 'desc' ? bTime - aTime : aTime - bTime;
  } else {
    const aTime = ((a as any)?.updatedAt ? new Date((a as any).updatedAt).getTime() : (a._id ? new Date(a._id).getTime() : 0));
    const bTime = ((b as any)?.updatedAt ? new Date((b as any).updatedAt).getTime() : (b._id ? new Date(b._id).getTime() : 0));
    return sortOrder === 'desc' ? bTime - aTime : aTime - bTime;
  }
}; 